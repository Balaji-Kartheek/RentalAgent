<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Avaamo ChatBot Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .llamb-link {
            color: #007bff;
            text-decoration: none;
        }
        .llamb-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<h2>Avaamo ChatBot Embedded</h2>

<!-- Placeholder for Avaamo Web Chat Frame -->
<div id="avaamo-chat-container"></div>

<script>
    var AvaamoChatBot = function(t) {
        function o(t, o) {
            var n = document.createElement("script");
            n.setAttribute("src", t),
            n.setAttribute("id", "avm-web-channel"),
            n.onload = o,
            document.body.appendChild(n)
        }

        return this.options = t || {},
        this.load = function(t) {
            o(this.options.url, function() {
                window.Avaamo.addFrame();
                t && typeof t === "function" && t(window.Avaamo);
            });
        }, this;
    };

    var chatBox = new AvaamoChatBot({
        url: "https://c6.avaamo.com/web_channels/0968fab7-4e6c-445f-961f-47c011c58f2a"
    });

    chatBox.load(function(avaamo) {

        avaamo.onBotStreamMessage = function(content, fullMessage) {
            // Optional: If the platform sends fullMessage.context, extract it
            try {
                if (fullMessage && fullMessage.context && fullMessage.context.user) {
                    const user = fullMessage.context.user;
                    let debugInfo = `
                        <div style="margin-top:10px; background:#eef; padding:10px; border-radius:8px;">
                            <strong>User Context Debug:</strong><br>
                            First Name: ${user.first_name || 'N/A'}<br>
                            Last Name: ${user.last_name || 'N/A'}<br>
                            Email: ${user.email || 'N/A'}<br>
                            UUID: ${user.uuid || 'N/A'}<br>
                            Phone: ${user.phone || 'N/A'}<br>
                            SSN: ${user.ssn || 'N/A'}<br>
                            IP Address: ${user.ip_address || 'N/A'}
                        </div>`;
                    content += debugInfo;
                }
            } catch (e) {
                console.error("Error processing context.user info:", e);
            }

            // Convert markdown-style links to HTML
            content = content.replace(/(?<!<source>.*?)(\[(.*?)\]\((https?:\/\/[^\s]+)\))/g, '<a class="llamb-link" target="_blank" href="$3">$2</a>');

            avaamo.renderBotStreamMessage(content);
        };

    });
</script>

</body>
</html>
